= Wordpress to Antora Conversion

:author: NorthwestOpenData
:revdate: 25.11.2021
:revremark: Blog Post

_Posted : {revremark} : {revdate} - {author}_

image::Antora_Peak.jpg[]

_Antora Peak - 13,275 feet is located in Rio Grande National Forest, 4.6 miles west-northwest of the Town of Bonanza in Saguache County, Colorado, United States. - Wikipedia_

== Background

I started this project in January 2020 and initially set up a Wordpress(WP) site
to document the learning process. I think WP is pretty good, it's free, easy to
install and use. It's got hundreds of themes and plugins, it's easy to manage,
relatively secure and commercially adaptable. With that said _what's my problem_? 

Well on reflection I don't feel this is a blog, it's an exploration of a problem,
more like an obervational field notebook, where the 'observations' are
suitable for a 'blog' style but there is not the space for the 'synthesis' articles
and the continual reworking of the work.

There's also an element of IT fundamentalism at play, the data source of a WP site
is a https://www.mysql.com/[MySQL] database. When hosting commercially you are likely
to be running on a shared server this will impact user performance and to a certain 
extent the writers process. I found the performance quite slow also I found myself 
spending more time writing posts than doing what I enjoyed.

I like markdown languages, which are shorthand for html, they are easy to learn, 
fast to write in a bare bones text editor. I've used AsciiDoc for several years
and AsciiDoctor in particular. It's feature rich yet readable in it's source *but*
more importantly it's ascii, the https://en.wikipedia.org/wiki/Lingua_franca[lingua franca] 
of computing. I can take them between operating systems, store them in
source code control systems, write scripts to generate pages. 

There's a rich ecology developing around AsciiDoc, I had considered adopting 'Hugo'
as a website platform but my background use of AsciiDoc finally nudged me in the 
direction of adopting Antora as my static website generator. I also realised Antora
was much more than a documentation site generator and I would only be interested in 
a few of it's features and would be looking to remove alot of the options available 
by default.

The following are some basic technical points and reminders to myself for working 
with Antora to create a static website. I would point out I am no expert in node, 
html, css or javascript in general. I read the Antora docs and did a bit of '_playing_'

== Installation

* https://docs.antora.org/antora/2.3/install-and-run-quickstart/[Quickstart Guide] 
 I would stop at 'Create a playbook' if you are new to Antora
* There are detailed guides for 
https://docs.antora.org/antora/3.0/install/linux-requirements/#install-nvm[Linux], 
https://docs.antora.org/antora/3.0/install/windows-requirements/[Window] or 
https://docs.antora.org/antora/3.0/install/macos-requirements/#install-nvm[MacOS].
* If you want to make changes to the default UI or them you will need to install `gulp` - See https://docs.antora.org/antora-ui-default/prerequisites/[here] for details.


TIP: After installation you need to understand the filesystem layout *before* you get
involved in setting up any `.yml` files

== Configure Directories

A content source is a git repository, I think the minimal requirement is a `git init` 
followed by a commit on a local filesystem. Once I had the structure complete and a few
pages written I committed/pushed to GitHub to test the full Antora build.


.Source Filesystem
----
.
├── README.md                  <.>
├── antora.yml                 <.>
└── .git                       <.>
└── modules                    <.>
    ├── ROOT                   <.>
    │   ├── images
    │   │   ├── github.png
    │   │   ├── nwod.png
    │   │   ├── reddit.png
    │   │   └── twitter.png
    │   ├── pages
    │   │   └── index.adoc
    │   └── partials
    │       └── nav.adoc
    ├── blog                   <.>
    │   ├── images
    │   ├── pages
    │   │   ├── index.adoc
    │   └── partials
    │       ├── nav.adoc
    └── docs                   <.>
        ├── examples
        ├── images
        ├── pages
        │   ├── index.adoc
        └── partials
            └── nav.adoc
----
<.> The repo README file
<.> The site's antora.yml file
<.> .git directory, subdirectories snipped
<.> The modules directory is the top level of the sites content
<.> The ROOT subdirectory - ROOT is a special key word that signifies a space for non specific files, this will become clearer when you see the output structure after running Antora. Basically I thought I would place my index page, privacy and T&C pages
<.> The blog subdirectory
<.> The docs sub directory

In each 'ROOT', 'blog' and 'docs' directory I created some subdirectories.
These were the locations of the content files, content types are described
below. Not all are compulsory.

|===
| Directory | Purpose | Access method
| attachments | For files to download eg .tar, .zip etc | AsciiDoc `link:` directive
| examples | For source code, terminal output, .csv data sets | AsciiDoc `include::` directive
| images | For image files included in pages(.png,.jpg,.svg,.gif) | AsciiDoc `image::` or `image:` directives 
| pages | AsciiDoc files(.adoc) These are automatically converted to .html | n/a
| partials | AsciiDoc fragments eg a table or list to be included in multiple .adoc pages | AsciiDoc `include::` directive
|===

== The `.yml` Files

There are two key 'YAML' files. https://yaml.org/[YAML] files are basically
config files for `antora', indentations are important but the format is quite
simple(see https://yaml.org/spec/1.2.2/#chapter-2-language-overview[here] for
details).

=== antora.yml

The `antora.yml` is located in the root level of the repository, it signals to
Antora the modules directory it also signals the version metadata

Here's my initial antora.yml

----
name: nwod                           <1>
title: Northwest Open Data           <2>
version: master                      <3>
nav:                                
- modules/ROOT/partials/nav.adoc     <4>
- modules/blog/partials/nav.adoc
- modules/docs/partials/nav.adoc
----
<1> Together with `version` uniquely identifies component version
<2> Used in pages, version selector, breadcrumbs etc
<3> Together with `name` uniquely identifies component version
<4> Identifies Navigation Files(`nav.adoc`) - more on this later

See https://docs.antora.org/antora/2.3/component-version-descriptor/#locate-content-source-root-with-antora-yml[here] for futher information

=== antora-playbook.yml

This was my basic antora-playbook.yml

----
site:       <1>
  title: North West Open Data                 
  url: https://northwestopendata.org.uk

content:    <2>
  sources:
    - url: https://github.com/northwestopendata/nwod_www
      branches: main

ui:         <3>
  bundle:
    snapshot: true
    url: https://gitlab.com/antora/antora-ui-default/-/jobs/artifacts/HEAD/raw/build/ui-bundle.zip?job=bundle-stable
----
<1> This is the site name and url of the website. See https://docs.antora.org/antora/2.3/playbook/site-url/#when-should-the-site-url-be-set[When should the site URL be set?]
<2> This defines where the content can be found, in this case GitHub, but it could be a local directory. See <<Transferring the Content>> for a local directory example.
<3> This is the UI or the theme to use. Antora splits content from theme.

== Building 

You can then generate a website by running antora from the command line

----
 antora antora-playbook.yml
----

A local directory was created called `build` containing the generated html files, images and
in the `_` directory the css, fonts, javascript etc required

----
.
└── site
    ├── 404.html
    ├── _
    │   ├── css
    │   │   └── site.css
    │   ├── font
    │   │   └── roboto-mono-*               # content snipped
    │   ├── img
    │   │   └──                             # content snipped
    │   └── js
    │       ├── site.js
    │       └── vendor
    │           └── highlight.js
    ├── index.html
    ├── nwod
    │   ├── _images
    │   ├── blog
    │   │   ├── _images
    │   │   ├── index.html
    │   ├── docs
    │   │   ├── _images
    │   │   ├── index.html
    │   └── index.html
    ├── robots.txt
    └── sitemap.xml
----

== The Default Output

After generating, open the index.html page in a browser to view the default structure of the generated website.

image::antora1.png[]

. The site name (site: title)
. Default navigation features, links and drop downs
. A download button for the page
. The site name (site: title) again 
. The breadcrumb location
. This allows editing of the file on GitHub
. The site navigation, created with nav.adoc files(antora.yml)
. The web page
. The table of contents(toc) for the page

image::antora2.png[]

[start=10]

. The version navigation widget
. The page footer

For the time being I was quite pleased with the results but Antora is designed
for working with multiversion documentation content. I was going to have to
simplify some of the features as my requirements for a basic website did not
require alot of the features on Antora.

== Transferring the Content

Rather than pushing and pulling from GitHub - I decided to set up a local working
environment as suggested in the documentation. So I created a directory and located 
the following within it.

* `nwod_www` which contained the content repo
* `cache` directory, I seemed to experience problems when generating the site 
 where changes weren't picked up. I didn't really get to the bottom of the problem
 but I wrote a small shell script to build the site where I deleted and recreated
 the cache area each time.
* `build.sh` a simple shell script to run antora with either the local or site 
 playbook
* `antora_ui_default` this contains the original source code extracted from the 
 ui-bundle.zip.
* `ui-bundle.zip` itself located at the top level
* I also created a couple of `playbook.yml` files:
** `antora-local-playbook.yml` where the content and ui values are
----
	content:
	  sources:
	    - url: ./nwod_www       <1>
	      branches: HEAD        <2>

	ui:
	  bundle:
	    snapshot: true
	    url: ./ui-bundle.zip    <3>
----
<1> Use the local repo directory
<2> `HEAD` is a special keyword to signify a local files repo
<3> Use the local zip file to theme the website
** `antora-site-playbook` with the following content
----
	content:
	  sources:
	    - url: https://github.com/northwestopendata/nwod_www  <1>
	      branches: main
	      edit_url: false                                     <2>
----
<1> Alway build the website from the GitHub repo
<2> Turn off the 'Edit this Page' button (see  item 6 <<The Default Output>>)

Then it was just a matter of transferring the Wordpress web pages via cut and
paste into .adoc files in vi.  Download and save any images I had to and 
recreate some charts that were originally made by custom plugins, it took 
me a couple of weekends and the odd hour midweek. It also gave me a chance 
to correct spelling mistakes and add some updates for any parts that had 
changed.

== Theming with the UI

One of the things I liked about Antora is that working with the content is
cleanly seperated from the look and feel, theme or in Antora speak the 'UI'
of the website

WARNING: For quick minor changes to the UI it may be better to look at 
https://docs.antora.org/antora/3.0/publish-to-github-pages/#use-the-supplemental-ui[supplemental] 
files . A good example is at https://lightbend.github.io/antora-supplemental-ui-lightbend-theme/build/site/index.html[Lightbend]

=== Working with the default UI

Changing the default UI is https://docs.antora.org/antora-ui-default/[well documented]

I decided to unzip the antora-ui-default bundle to see what was inside and 
try and relate that to the website

Below is a list of changes I have made

=== Page Layout

==== Header bar changes
.Page Header
image::antora7.png[]

* I changed `header-contents.hbs` to remove unwanted items, I decided on a simple 'Home' 
and a dropdown to other areas of the site. Currently Blog and Documents under a Navigation item

* The Site name is picked up from the `antora.yml`

* The 'Edit this Page' button will be removed via the playbook `edit_url: false` content 
optin

.Page Footer
image::antora8.png[]

* The `footer.content.hbs` is the easiest file to work with, I added some links to social media, 
kept but expanded info regarding website generation and addeda (C) statement and a link to the 
current page

* I wanted to remove the default version selector from the page, I did this by commenting out 
the `nav-explore.hbs` file

=== CSS Changes

* Header background text colour

* Missing AsciiDoc Functionality in Antora
** overline
** collapsible

* Personal Changes
** Table header

NOTE: Need to add a subscript text to header or maybe an image 

=== AsciiDoc Attributes
